<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Riwayat Transaksi - Kuotaumroh.id</title>
  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href="public/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="public/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="public/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="public/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="public/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="public/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="public/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="public/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="public/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="public/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="public/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="public/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="public/favicon/favicon-16x16.png">
  <link rel="manifest" href="public/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#10b981">
  <meta name="msapplication-TileImage" content="public/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#10b981">


  <!-- Google Fonts - Figtree -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Alpine.js for reactivity -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- Shared CSS -->
  <link rel="stylesheet" href="shared/styles.css">

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            border: "hsl(var(--border))",
            input: "hsl(var(--input))",
            ring: "hsl(var(--ring))",
            background: "hsl(var(--background))",
            foreground: "hsl(var(--foreground))",
            primary: {
              DEFAULT: "hsl(var(--primary))",
              foreground: "hsl(var(--primary-foreground))",
            },
            secondary: {
              DEFAULT: "hsl(var(--secondary))",
              foreground: "hsl(var(--secondary-foreground))",
            },
            destructive: {
              DEFAULT: "hsl(var(--destructive))",
              foreground: "hsl(var(--destructive-foreground))",
            },
            muted: {
              DEFAULT: "hsl(var(--muted))",
              foreground: "hsl(var(--muted-foreground))",
            },
            accent: {
              DEFAULT: "hsl(var(--accent))",
              foreground: "hsl(var(--accent-foreground))",
            },
            success: {
              DEFAULT: "hsl(var(--success))",
              foreground: "hsl(var(--success-foreground))",
            },
          },
          fontFamily: {
            sans: ['Figtree', 'ui-sans-serif', 'system-ui', '-apple-system', 'sans-serif'],
          },
          borderRadius: {
            lg: "var(--radius)",
            md: "calc(var(--radius) - 2px)",
            sm: "calc(var(--radius) - 4px)",
          },
          container: {
            center: true,
            padding: "2rem",
            screens: {
              "2xl": "1400px",
            },
          },
        },
      },
    }
  </script>
</head>

<body class="min-h-screen bg-background">
  <!-- Alpine.js Main App -->
  <div x-data="historyApp()">

    <!-- Header -->
    <header class="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur">
      <div class="container mx-auto flex h-16 items-center justify-between px-4">
        <!-- Logo -->
        <a href="dashboard.html" class="flex items-center gap-2">
          <img src="public/images/kabah.png" alt="Kuotaumroh.id Logo" class="h-9 w-9 object-contain">
          <span class="text-xl font-semibold">Kuotaumroh.id</span>
        </a>

        <!-- User Dropdown -->
        <div class="relative" x-data="{ open: false }">
          <button
            @click="open = !open"
            class="flex h-10 items-center gap-2 rounded-full px-3 hover:bg-muted transition-colors"
          >
            <span class="hidden text-sm font-semibold sm:inline" x-text="user.name"></span>
            <div class="h-9 w-9 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium">
              <span x-text="user.initials"></span>
            </div>
          </button>

          <!-- Dropdown Menu -->
          <div
            x-show="open"
            @click.away="open = false"
            x-cloak
            class="dropdown-menu absolute right-0 mt-2 w-56 rounded-md border bg-white shadow-lg"
          >
            <div class="px-3 py-3 text-sm">
              <p class="font-medium" x-text="user.name"></p>
              <p class="text-xs text-muted-foreground" x-text="user.email"></p>
              <p class="text-xs text-primary font-medium pt-1" x-text="user.agentCode"></p>
            </div>
            <div class="h-px bg-border"></div>
            <button class="flex w-full items-center px-3 py-2 text-sm hover:bg-muted">
              <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              Profil
            </button>
            <button class="flex w-full items-center px-3 py-2 text-sm hover:bg-muted">
              <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              Pengaturan
            </button>
            <div class="h-px bg-border"></div>
            <button
              @click="logout()"
              class="flex w-full items-center px-3 py-2 text-sm text-destructive hover:bg-muted"
            >
              <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
              </svg>
              Keluar
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto py-6 animate-fade-in px-4">
      <!-- Page Header -->
      <div class="mb-6">
        <h1 class="text-3xl font-bold tracking-tight">Riwayat Transaksi</h1>
        <p class="text-muted-foreground mt-2">Lihat semua transaksi yang telah Anda buat</p>
      </div>

      <!-- Transactions Table Card -->
      <div class="rounded-lg border bg-white shadow-sm">
        <div class="p-6">
          <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
            <h3 class="text-lg font-semibold">Daftar Transaksi</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
              <!-- Search Input -->
              <div class="relative">
                <svg class="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <input
                  type="text"
                  placeholder="Cari batch/tanggal/nominal"
                  x-model="search"
                  class="flex h-10 rounded-md border border-input bg-background pl-9 pr-3 py-2 text-sm w-full sm:w-[200px]"
                >
              </div>
              <!-- Status Filter -->
              <select
                x-model="statusFilter"
                class="flex h-10 rounded-md border border-input bg-background px-3 py-2 text-sm w-full sm:w-[150px]"
              >
                <option value="all">Semua Status</option>
                <option value="success">Berhasil</option>
                <option value="processing">Diproses</option>
                <option value="failed">Gagal</option>
              </select>
            </div>
          </div>

          <!-- Table -->
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b">
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                    <button @click="handleSort('batchId')" class="inline-flex items-center gap-2">
                      Batch ID
                      <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                      </svg>
                    </button>
                  </th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                    <button @click="handleSort('batchName')" class="inline-flex items-center gap-2">
                      Nama Batch
                      <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                      </svg>
                    </button>
                  </th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                    <button @click="handleSort('createdAt')" class="inline-flex items-center gap-2">
                      Tanggal
                      <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                      </svg>
                    </button>
                  </th>
                  <th class="h-12 px-4 text-center align-middle font-medium text-muted-foreground">
                    <button @click="handleSort('msisdnCount')" class="inline-flex items-center gap-2">
                      Jumlah Nomor HP
                      <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                      </svg>
                    </button>
                  </th>
                  <th class="h-12 px-4 text-right align-middle font-medium text-muted-foreground">
                    <button @click="handleSort('totalAmount')" class="inline-flex items-center gap-2">
                      Total
                      <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                      </svg>
                    </button>
                  </th>
                  <th class="h-12 px-4 text-center align-middle font-medium text-muted-foreground">
                    <button @click="handleSort('status')" class="inline-flex items-center gap-2">
                      Status
                      <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                      </svg>
                    </button>
                  </th>
                  <th class="h-12 px-4 text-center align-middle font-medium text-muted-foreground">Aksi</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="tx in sortedTransactions" :key="tx.id">
                  <tr class="border-b transition-colors hover:bg-muted/50">
                    <td class="p-4 align-middle font-mono text-sm" x-text="tx.batchId"></td>
                    <td class="p-4 align-middle font-medium" x-text="tx.batchName"></td>
                    <td class="p-4 align-middle" x-text="formatDateTime(tx.createdAt)"></td>
                    <td class="p-4 align-middle text-center" x-text="tx.msisdnCount"></td>
                    <td class="p-4 align-middle text-right font-medium" x-text="formatRupiah(tx.totalAmount)"></td>
                    <td class="p-4 align-middle text-center">
                      <span
                        class="badge"
                        :class="getStatusBadgeClass(tx.status)"
                        x-text="getStatusLabel(tx.status)"
                      ></span>
                    </td>
                    <td class="p-4 align-middle text-center">
                      <button
                        @click="viewDetails(tx)"
                        class="inline-flex items-center justify-center rounded-md border bg-transparent h-8 w-8 hover:bg-muted transition-colors"
                      >
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                      </button>
                    </td>
                  </tr>
                </template>
                <template x-if="sortedTransactions.length === 0">
                  <tr>
                    <td colspan="7" class="p-8 text-center text-muted-foreground">
                      Tidak ada transaksi yang ditemukan
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <!-- Detail Modal -->
    <div
      x-show="selectedTransaction"
      x-cloak
      class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
      @click.self="closeDetails()"
    >
      <div class="relative bg-white rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-hidden animate-fade-in">
        <!-- Modal Header -->
        <div class="p-6 border-b">
          <div class="flex items-start justify-between">
            <div>
              <h2 class="text-lg font-semibold">Detail Transaksi</h2>
              <p class="text-sm text-muted-foreground mt-1" x-show="selectedTransaction">
                <span x-text="selectedTransaction?.batchId"></span> - <span x-text="selectedTransaction?.batchName"></span>
              </p>
            </div>
            <button
              @click="closeDetails()"
              class="rounded-md p-2 hover:bg-muted transition-colors"
            >
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Modal Body -->
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]" x-show="selectedTransaction">
          <div class="space-y-4">
            <!-- Transaction Summary -->
            <div class="grid grid-cols-2 gap-4 text-sm">
              <div>
                <p class="text-muted-foreground">Tanggal</p>
                <p class="font-medium" x-text="selectedTransaction ? formatDateTimeFull(selectedTransaction.createdAt) : ''"></p>
              </div>
              <div>
                <p class="text-muted-foreground">Status</p>
                <p>
                  <span
                    class="badge"
                    :class="selectedTransaction ? getStatusBadgeClass(selectedTransaction.status) : ''"
                    x-text="selectedTransaction ? getStatusLabel(selectedTransaction.status) : ''"
                  ></span>
                </p>
              </div>
              <div>
                <p class="text-muted-foreground">Jumlah Nomor HP</p>
                <p class="font-medium"><span x-text="selectedTransaction?.msisdnCount"></span> nomor</p>
              </div>
              <div>
                <p class="text-muted-foreground">Total Pembayaran</p>
                <p class="font-medium" x-text="selectedTransaction ? formatRupiah(selectedTransaction.totalAmount) : ''"></p>
              </div>
            </div>

            <!-- Detail Items Table -->
            <div class="border-t pt-4">
              <p class="font-medium mb-2">Detail Nomor HP</p>
              <div class="relative mb-3">
                <svg class="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <input
                  type="text"
                  placeholder="Cari nomor/provider/paket/harga"
                  x-model="detailSearch"
                  class="flex h-10 rounded-md border border-input bg-background pl-9 pr-3 py-2 text-sm w-full"
                >
              </div>
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead>
                    <tr class="border-b">
                      <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground text-sm">
                        <button @click="handleDetailSort('msisdn')" class="inline-flex items-center gap-2">
                          Nomor HP
                          <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                          </svg>
                        </button>
                      </th>
                      <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground text-sm">
                        <button @click="handleDetailSort('provider')" class="inline-flex items-center gap-2">
                          Provider
                          <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                          </svg>
                        </button>
                      </th>
                      <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground text-sm">
                        <button @click="handleDetailSort('packageName')" class="inline-flex items-center gap-2">
                          Paket
                          <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                          </svg>
                        </button>
                      </th>
                      <th class="h-12 px-4 text-right align-middle font-medium text-muted-foreground text-sm">
                        <button @click="handleDetailSort('price')" class="inline-flex items-center gap-2">
                          Harga
                          <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                          </svg>
                        </button>
                      </th>
                      <th class="h-12 px-4 text-center align-middle font-medium text-muted-foreground text-sm">
                        <button @click="handleDetailSort('status')" class="inline-flex items-center gap-2">
                          Status
                          <svg class="h-4 w-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                          </svg>
                        </button>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <template x-for="(item, idx) in sortedDetails" :key="idx">
                      <tr class="border-b transition-colors hover:bg-muted/50">
                        <td class="p-4 align-middle font-mono text-sm" x-text="item.msisdn"></td>
                        <td class="p-4 align-middle" x-text="item.provider"></td>
                        <td class="p-4 align-middle" x-text="item.packageName"></td>
                        <td class="p-4 align-middle text-right" x-text="formatRupiah(item.price)"></td>
                        <td class="p-4 align-middle text-center">
                          <span
                            class="badge"
                            :class="getStatusBadgeClass(item.status)"
                            x-text="getStatusLabel(item.status)"
                          ></span>
                        </td>
                      </tr>
                    </template>
                    <template x-if="selectedTransaction && selectedTransaction.items.length === 0">
                      <tr>
                        <td colspan="5" class="p-6 text-center text-muted-foreground">
                          Detail nomor belum tersedia.
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div
      x-show="toastVisible"
      x-transition
      class="toast"
    >
      <div class="font-semibold mb-1" x-text="toastTitle"></div>
      <div class="text-sm text-muted-foreground" x-text="toastMessage"></div>
    </div>
  </div>

  <!-- Alpine.js Application Logic -->
  <script>
    function historyApp() {
      return {
        // User data
        user: {
          name: '',
          email: '',
          agentCode: '',
          initials: ''
        },

        // Search & filters
        search: '',
        statusFilter: 'all',

        // Sorting
        sortKey: 'createdAt',
        sortDirection: 'desc',

        // Modal state
        selectedTransaction: null,
        detailSearch: '',
        detailSortKey: 'msisdn',
        detailSortDirection: 'asc',

        // Toast
        toastVisible: false,
        toastTitle: '',
        toastMessage: '',

        // Mock transactions data
        transactions: [
          { 
            id: '1', 
            batchId: 'ORD-2024-0115', 
            batchName: 'Batch Januari Group A',
            createdAt: new Date('2024-01-15T10:30:00'), 
            msisdnCount: 25, 
            totalAmount: 6250000, 
            status: 'success',
            items: [
              { msisdn: '081234567890', provider: 'Telkomsel', packageName: 'Umroh Gold 10GB', price: 250000, status: 'success' },
              { msisdn: '081234567891', provider: 'Telkomsel', packageName: 'Umroh Gold 10GB', price: 250000, status: 'success' },
              { msisdn: '085234567892', provider: 'Indosat', packageName: 'Umroh Silver 5GB', price: 150000, status: 'success' },
            ]
          },
          { 
            id: '2', 
            batchId: 'ORD-2024-0112', 
            batchName: 'Pesanan Individual',
            createdAt: new Date('2024-01-12T14:15:00'), 
            msisdnCount: 5, 
            totalAmount: 1250000, 
            status: 'processing',
            items: [
              { msisdn: '081234567893', provider: 'Telkomsel', packageName: 'Umroh Gold 10GB', price: 250000, status: 'processing' },
              { msisdn: '081234567894', provider: 'Telkomsel', packageName: 'Umroh Gold 10GB', price: 250000, status: 'processing' },
            ]
          },
          { 
            id: '3', 
            batchId: 'ORD-2024-0110', 
            batchName: 'Batch Desember Group B',
            createdAt: new Date('2024-01-10T09:00:00'), 
            msisdnCount: 15, 
            totalAmount: 3750000, 
            status: 'success',
            items: []
          },
          { 
            id: '4', 
            batchId: 'ORD-2024-0108', 
            batchName: 'Pesanan Gagal Test',
            createdAt: new Date('2024-01-08T16:45:00'), 
            msisdnCount: 3, 
            totalAmount: 750000, 
            status: 'failed',
            items: []
          },
        ],

        // Lifecycle
        init() {
          const savedUser = getUser();
          if (savedUser && savedUser.name) {
            this.user = {
              ...savedUser,
              initials: this.getInitials(savedUser.name)
            };
          }

          if (!isLoggedIn()) {
            window.location.href = 'login.html';
          }
        },

        // Computed: Filtered Transactions
        get filteredTransactions() {
          return this.transactions.filter(tx => {
            // Status filter
            if (this.statusFilter !== 'all' && tx.status !== this.statusFilter) {
              return false;
            }

            // Search filter
            if (!this.search.trim()) {
              return true;
            }

            const query = this.search.toLowerCase();
            const searchable = [
              tx.batchId,
              tx.batchName,
              formatDateTime(tx.createdAt),
              String(tx.msisdnCount),
              formatRupiah(tx.totalAmount),
              String(tx.totalAmount),
            ].join(' ').toLowerCase();

            return searchable.includes(query);
          });
        },

        // Computed: Sorted Transactions
        get sortedTransactions() {
          return [...this.filteredTransactions].sort((a, b) => {
            let comparison = 0;
            switch (this.sortKey) {
              case 'batchId':
                comparison = a.batchId.localeCompare(b.batchId);
                break;
              case 'batchName':
                comparison = a.batchName.localeCompare(b.batchName);
                break;
              case 'createdAt':
                comparison = a.createdAt.getTime() - b.createdAt.getTime();
                break;
              case 'msisdnCount':
                comparison = a.msisdnCount - b.msisdnCount;
                break;
              case 'totalAmount':
                comparison = a.totalAmount - b.totalAmount;
                break;
              case 'status':
                comparison = this.getStatusLabel(a.status).localeCompare(this.getStatusLabel(b.status));
                break;
              default:
                comparison = 0;
            }
            return this.sortDirection === 'asc' ? comparison : -comparison;
          });
        },

        // Computed: Sorted Detail Items
        get sortedDetails() {
          if (!this.selectedTransaction) return [];
          
          const filtered = this.selectedTransaction.items.filter(item => {
            if (!this.detailSearch.trim()) return true;
            
            const query = this.detailSearch.toLowerCase();
            const searchable = [
              item.msisdn,
              item.provider,
              item.packageName,
              formatRupiah(item.price),
              String(item.price),
            ].join(' ').toLowerCase();
            
            return searchable.includes(query);
          });

          return [...filtered].sort((a, b) => {
            let comparison = 0;
            switch (this.detailSortKey) {
              case 'msisdn':
                comparison = a.msisdn.localeCompare(b.msisdn);
                break;
              case 'provider':
                comparison = a.provider.localeCompare(b.provider);
                break;
              case 'packageName':
                comparison = a.packageName.localeCompare(b.packageName);
                break;
              case 'price':
                comparison = a.price - b.price;
                break;
              case 'status':
                comparison = this.getStatusLabel(a.status).localeCompare(this.getStatusLabel(b.status));
                break;
              default:
                comparison = 0;
            }
            return this.detailSortDirection === 'asc' ? comparison : -comparison;
          });
        },

        // Methods
        getInitials(name) {
          return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
        },

        handleSort(key) {
          if (this.sortKey === key) {
            this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
          } else {
            this.sortKey = key;
            this.sortDirection = key === 'createdAt' ? 'desc' : 'asc';
          }
        },

        handleDetailSort(key) {
          if (this.detailSortKey === key) {
            this.detailSortDirection = this.detailSortDirection === 'asc' ? 'desc' : 'asc';
          } else {
            this.detailSortKey = key;
            this.detailSortDirection = 'asc';
          }
        },

        viewDetails(tx) {
          this.selectedTransaction = tx;
          this.detailSearch = '';
          this.detailSortKey = 'msisdn';
          this.detailSortDirection = 'asc';
        },

        closeDetails() {
          this.selectedTransaction = null;
          this.detailSearch = '';
        },

        getStatusLabel(status) {
          switch (status) {
            case 'success': return 'Berhasil';
            case 'processing': return 'Diproses';
            case 'failed': return 'Gagal';
            default: return status;
          }
        },

        getStatusBadgeClass(status) {
          switch (status) {
            case 'success': return 'badge-primary';
            case 'processing': return 'badge-secondary';
            case 'failed': return 'badge-destructive';
            default: return 'badge-outline';
          }
        },

        formatDateTimeFull(date) {
          const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
          const d = new Date(date);
          const hours = String(d.getHours()).padStart(2, '0');
          const minutes = String(d.getMinutes()).padStart(2, '0');
          return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}, ${hours}:${minutes} WIB`;
        },

        showToast(title, message) {
          this.toastTitle = title;
          this.toastMessage = message;
          this.toastVisible = true;
          setTimeout(() => { this.toastVisible = false; }, 3000);
        },

        logout() {
          clearUser();
          window.location.href = 'login.html';
        }
      }
    }
  </script>

  <!-- Shared Scripts -->
  <script src="shared/utils.js"></script>
  <script src="shared/api.js"></script>
  <script src="shared/components.js"></script>
<!-- WUUNU SNIPPET - DON'T CHANGE THIS (START) -->
<script>window.__WUUNU_WS__ = "http://127.0.0.1:53948/?token=fd2593a903940808c14fe666980a4d1b36163c154479be92";</script>
<script id="wuunu-widget-script" data-wuunu-widget src="https://cdn.jsdelivr.net/npm/@wuunu/widget@0.1" defer crossOrigin="anonymous"></script>
<!-- WUUNU SNIPPET - DON'T CHANGE THIS (END) -->
</body>
</html>
